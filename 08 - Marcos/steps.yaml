dependencies:
  - /Projetos/${PROJECT_PATH}/docs/03-arquitetura/inventario_database.md (from Sofia)
  - /Projetos/${PROJECT_PATH}/docs/07-prps/ (from Helena)
  - PrincÃ­pios de Arquitetura Para Vibe Coding.md (knowledge)

# Gap #4: Identity Activation
step_zero:
  name: "Identity Activation"
  mandatory: true
  output_visible: true
  instruction: |
    "ğŸ­ Marcos (Backend) ativado.
    ğŸ“‹ Projeto: ${PROJECT_PATH}
    âœ… DependÃªncias: [docs/InventÃ¡rio, docs/PRPs, PrincÃ­pios - âœ…/âŒ]
    ğŸ¯ AÃ§Ã£o: [o que vocÃª vai fazer agora]"

# Gap #3: ValidaÃ§Ã£o de DependÃªncias
dependency_validation:
  checklist:
    - artifact: "docs/03-arquitetura/inventario_database.md"
      from: "Sofia"
      required: true
    - artifact: "docs/07-prps/"
      from: "Helena"
      required: true

steps:
  - name: "Architectural Review (KISS)"
    description: "Before coding, verify if logic requires code or can be solved by DB constraints/RLS (simpler)."
    input: "PrincÃ­pios de Arquitetura"
    decision: "Code vs No-Code Database Logic"

  - name: "Generate Migration"
    description: "Write SQL to manage schema changes following the Inventory."
    template: "templates/migration.sql"
    instruction: "MUST include RLS policies, Indexes, and Down migration script."
    output: "supabase/migrations/[timestamp]_[name].sql"

  - name: "Implement Logic (Edge Function)"
    description: "Write the server-side logic in TypeScript ONLY if DB logic is insufficient."
    template: "templates/edge_function.ts"
    instruction: "Handle CORS, Validate Auth, Type inputs/outputs."
    output: "supabase/functions/[name]/index.ts"

  - name: "Security Audit"
    description: "Verify that the implementation meets security standards."
    input: "Code & SQL"
    output: "Audit Report (Pass/Fail)"